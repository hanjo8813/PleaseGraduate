{% extends 'reference.html' %}

{% block content %}

<div class="gray_sec">
    <div class="container">
        <div style="font-size:4rem;">
            <i class="fas fa-graduation-cap"></i>
        </div>
        <div class="big_title">ê¸°ì´ìˆ˜ê³¼ëª© ì»¤ìŠ¤í…€</div>
    </div>
</div>

<div class="white_sec">
    <div class="custom_box_wrap">
        <!-- ì‚¬ìš©ë²• ë°•ìŠ¤ -->
        <div>
            <div class="custom_title">ì‚¬ìš©ë²•</div>
            <div class="custom_box">
                <p>1. ì¶”ê°€í•˜ê³  ì‹¶ì€ ê³¼ëª©ì˜ <span class="caution_info">í•™ìˆ˜ë²ˆí˜¸</span>ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>
                <p style="margin-left:1rem; font-size:0.85rem;">- í•™ìˆ˜ë²ˆí˜¸ ì°¾ëŠ” ë²• :
                    <a class="link_site" target="_blank"
                        href="https://portal.sejong.ac.kr/jsp/login/uisloginSSL.jsp?rtUrl=uis.sejong.ac.kr/app/sys.Login.servj?strCommand=SSOLOGIN">UIS</a>
                    -> ì™¼ìª½ ë©”ë‰´ë°”ì—ì„œ ìˆ˜ì—…/ì„±ì  -> ê°•ì¢Œì¡°íšŒ ë° ìˆ˜ê°•ì‹ ì²­ -> ê°•ì˜ì‹œê°„í‘œì¡°íšŒ -> êµê³¼ëª©ëª…ìœ¼ë¡œ ê²€ìƒ‰
                </p>
                <p>2. ê²€ìƒ‰ í›„ í•´ë‹¹ ê³¼ëª©ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ê³ , ê³¼ëª©ì˜ <span class="caution_info">ì´ìˆ˜êµ¬ë¶„(ex. ì „ì„ , ì „í•„ ë“±)ì„ ë°˜ë“œì‹œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</span> </p>
                <p>3. ì´ìˆ˜êµ¬ë¶„ì„ ì„¤ì •í–ˆë‹¤ë©´ ì¶”ê°€í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„ì‹œ ê¸°ì´ìˆ˜ê³¼ëª© í‘œì— í•´ë‹¹ ê³¼ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
                <p>4. ì¶”ê°€ëœ ê³¼ëª©í‘œë¥¼ í™•ì¸í•˜ê³  ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìì‹ ì˜ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</p>
                <p>â€» ì—°ê³„ì „ê³µ ê³¼ëª©ì˜ ê²½ìš° ê³¼ëª© ê²€ìƒ‰ì´ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p>
            </div>
        </div>

        <!-- ê²€ìƒ‰ì°½ ë°•ìŠ¤ -->
        <div>
            <div>
                <div class="custom_title">í•™ìˆ˜ë²ˆí˜¸ ê²€ìƒ‰</div>
            </div>
            <div class="my_box_grade">
                <div style="padding:2.5rem 2.5rem 0 2.5rem">

                    <!-- ê²€ìƒ‰ ê¸°ëŠ¥ -->
                    <div class="custom_form">
                        <input type="text" id="s_num" placeholder="í•™ìˆ˜ë²ˆí˜¸">
                        <button class="ajax_search_btn" onclick="ajax_conn()">ê²€ìƒ‰</button>
                    </div>

                    <!-- ê²€ìƒ‰ê²°ê³¼ ë°•ìŠ¤ -->
                    <div class="result_zone">
                        <div class="custom_subtitle">
                            âŒ¨ï¸ ê²€ìƒ‰ ê²°ê³¼
                            <p
                                style="color:rgb(199, 199, 199); font-size:0.9rem; font-weight: lighter; margin-top:0.4rem">
                                ìì‹ ì—ê²Œ ë§ëŠ” ì˜ˆìƒ ì´ìˆ˜êµ¬ë¶„ì„ ì„ íƒí•´ì•¼í•©ë‹ˆë‹¤
                            </p>
                        </div>

                        <!-- ì—¬ê¸°ê°€ ê²€ìƒ‰ì‹œ ê²°ê³¼ë¥¼ ë„ì›Œì£¼ëŠ” div@!!!!! -->
                        <div id="result_div"></div>
                    </div>

                    <!-- ë‚´ ê¸°ì´ìˆ˜ê³¼ëª© ì£¼ë£¨ë£© -->
                    <div style="margin-top:5rem;">
                        <!-- -->
                        <form action='/f_add_custom/' method='post' onclick='combine()'>
                            {% csrf_token %}
                            <div class="my_box_title">
                                <div style="width: 10%;"></div>
                                <div>ë‚´ ê¸°ì´ìˆ˜ê³¼ëª©</div>
                                <input type='submit' onclick='pop_modal()' class="save_btn" value='ì €ì¥í•˜ê¸°'>
                            </div>
                            <hr>
                            <table id="mytable" class="grade_table" style='margin-bottom:3rem;'>
                                <tr>
                                    <th class="grade_table_th" style="width:9%">ë…„ë„</th>
                                    <th class="grade_table_th" style="width:9%">í•™ê¸°</th>
                                    <th class="grade_table_th" style="width:9%">í•™ìˆ˜ë²ˆí˜¸</th>
                                    <th class="grade_table_th" style="width:36%">ê³¼ëª©ëª…</th>
                                    <th class="grade_table_th" style="width:9%">ì´ìˆ˜êµ¬ë¶„</th>
                                    <th class="grade_table_th" style="width:14%">ì„ íƒì˜ì—­</th>
                                    <th class="grade_table_th" style="width:6%;">í•™ì </th>
                                    <th class="grade_table_th" style="width:6%; border-right :0px"></th>
                                </tr>
               
                                <!-- ì»¤ìŠ¤í…€ ê³¼ëª© ë¨¼ì € ë„ìš°ê¸° -->
                                {% for cg in custom_grade %}
                                <tr style='color : #1ac06d'>
                                    <td class="grade_table_td">{{ cg.year }}</td>
                                    <td class="grade_table_td">{{ cg.semester }}</td>
                                    <td class="grade_table_td">{{ cg.subject_num }}</td>
                                    <td class="grade_table_td">{{ cg.subject_name }}</td>
                                    <td class="grade_table_td">{{ cg.classification }}</td>
                                    <td class="grade_table_td">{{ cg.selection }}</td>
                                    <td class="grade_table_td">{{ cg.grade | floatformat }}</td>
                                    <td class="grade_table_td" style="border-right :0px">
                                        <button class='del_btn' onclick='del_row_old(this)'>ì‚­ì œ</button>
                                    </td>
                                </tr>
                                {% endfor %}
                                {% for g in grade %}
                                <tr>
                                    <td class="grade_table_td">{{ g.year }}</td>
                                    <td class="grade_table_td">{{ g.semester }}</td>
                                    <td class="grade_table_td">{{ g.subject_num }}</td>
                                    <td class="grade_table_td">{{ g.subject_name }}</td>
                                    <td class="grade_table_td">{{ g.classification }}</td>
                                    <td class="grade_table_td">{{ g.selection }}</td>
                                    <td class="grade_table_td">{{ g.grade | floatformat }}</td>
                                    <td class="grade_table_td" style="border-right :0px"></td>
                                </tr>
                                {% endfor %}
                            </table>
                            <!-- ì¶”ê°€ëœ ê³¼ëª©ì •ë³´ + ì‚­ì œëœ ê³¼ëª© ì •ë³´ë¥¼ ë¬¶ì–´ì„œ ë³´ë‚´ì£¼ëŠ” ìˆ¨ê²¨ì§„ input-->
                            <input type='hidden' id='id_year' name='arr_year' value=''>
                            <input type='hidden' id='id_semester' name='arr_semester' value=''>
                            <input type='hidden' id='id_subject_num' name='arr_subject_num' value=''>
                            <input type='hidden' id='id_subject_name' name='arr_subject_name' value=''>
                            <input type='hidden' id='id_classification' name='arr_classification' value=''>
                            <input type='hidden' id='id_selection' name='arr_selection' value=''>
                            <input type='hidden' id='id_grade' name='arr_grade' value=''>
                            <input type='hidden' id='id_delete' name='arr_delete' value=''>
                        </form>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>
</div>


<div id='load_madal' class="modal">
    <div class="load-modal-content">
        <div class="modal_loadcontainer">
            <div class="sk-chase">
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
                <div class="sk-chase-dot"></div>
            </div>
            <div class="loading">
                <span>ì •</span>
                <span>ë³´</span>
                <span>ì—…</span>
                <span>ë°</span>
                <span>ì´</span>
                <span>íŠ¸</span>
                <span>ì¤‘</span>
                <span>.</span>
                <span>.</span>
                <span>.</span>
            </div>
            <div class="load_info">
                ì°½ì„ ì´ë™í•˜ì§€ ë§ˆì„¸ìš”!
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block js_section %}


<script>
    // ì €ì¥í•˜ê¸° í´ë¦­ì‹œ ë¡œë”©ëª¨ë‹¬
    function pop_modal() {
        document.getElementById('load_madal').style.display = "block";
    }

    // ì»¤ìŠ¤í…€ í˜ì´ì§€ì—ì„œì˜ ê³¼ëª© ì¶”ê°€/ì‚­ì œ í˜„í™©ì„ ì €ì¥í•˜ëŠ” í•™ìˆ˜ë²ˆí˜¸ ë°°ì—´
    var list_delete = []

    function ajax_conn() {
        // ajax í†µì‹  ì‹œì‘
        $.ajax(
            {
                type: 'POST',
                url: '/a_search/',
                // viewsì—ëŠ” back_s_num ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ inputì— ìˆëŠ” í•™ìˆ˜ë²ˆí˜¸ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
                data: { back_s_num: $("#s_num").val() },
                dataType: 'json',
                // ì„±ê³µì‹œ ë°±ì—ì„œ result ë³€ìˆ˜ê°€ ë„˜ì–´ì˜¨ë‹¤. 
                success: function (context) {
                    if (context['result'] === 'ê²€ìƒ‰ì‹¤íŒ¨') {
                        show_fail();
                    }
                    else {
                        show_table(context['result']);
                    }
                },
                // ì—ëŸ¬ì‹œ ì„¤ì •
                error: function (e) { }
            }
        );
    }

    function show_fail() {
        var div = document.querySelector('#result_div');
        html = "<div class='caution_div'>í•´ë‹¹ í•™ìˆ˜ë²ˆí˜¸ê°€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²€ìƒ‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>"
        div.innerHTML = html;
    }

    function show_table(result) {
        var div = document.querySelector('#result_div');
        html = "<table class='grade_table' style='margin-top:0'>";

        html += "<tr>";
        html += "<th class='grade_table_th' style='width:10%'>ë…„ë„</th>"
        html += "<th class='grade_table_th' style='width:10%'>í•™ê¸°</th>"
        html += "<th class='grade_table_th' style='width:10%'>í•™ìˆ˜ë²ˆí˜¸</th>"
        html += "<th class='grade_table_th' style='width:40%'>ê³¼ëª©ëª…</th>"
        html += "<th class='grade_table_th' style='width:10%'>ì´ìˆ˜êµ¬ë¶„</th>"
        html += "<th class='grade_table_th' style='width:14%'>ì„ íƒì˜ì—­</th>"
        html += "<th class='grade_table_th' style='width:6%; border-right :0px'>í•™ì </th>"
        html += "</tr>";

        html += "<tr>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='year' value='ì»¤ìŠ¤í…€' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='semester' value='2í•™ê¸°' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='subject_num' value='" + result[0] + "' readonly></td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='subject_name' value='" + result[1] + "' readonly></td>";
        html += "<td class='grade_table_td'>";
        html += "<select id='classification' class='td_input'>";
        html += "<option value='x' selected>-- ì„ íƒ --</option>"
        html += "<option value='ì „í•„'>ì „í•„</option>"
        html += "<option value='ì „ì„ '>ì „ì„ </option>"
        html += "<option value='êµí•„'>êµí•„</option>"
        html += "<option value='êµì„ 1'>êµì„ 1</option>"
        html += "<option value='êµì„ 2'>êµì„ 2</option>"
        html += "<option value='ê¸°êµ'>ê¸°êµ</option>"
        html += "<option value='ì—°í•„'>ì—°í•„</option>"
        html += "<option value='ì—°ì„ '>ì—°ì„ </option>"
        html += "<option value='ë³µí•„'>ë³µí•„</option>"
        html += "<option value='ë³µì„ '>ë³µì„ </option>"
        html += "</select>";
        html += "</td>";
        html += "<td class='grade_table_td'><input class='td_input' type='text' id='selection' value='" + result[3] + "' readonly></td>";
        html += "<td class='grade_table_td' style='border-right :0px'><input class='td_input' type='text' id='grade' value='" + result[4] + "' readonly></td>";
        html += "</tr>";

        html += "</table>";
        html += "<button class='add_btn' onclick='add_subject()'>ê³¼ëª© ì¶”ê°€í•˜ê¸°</button>";
        div.innerHTML = html;
    }

    function add_subject() {
        // ë§Œì•½ ì„ íƒì˜ì—­ ì„ íƒì•ˆí–ˆìœ¼ë©´ ë¹ ê¾¸
        var ts_box = document.getElementById('classification');
        var ts_ind = document.getElementById("classification").options.selectedIndex;
        if (ts_box.options[ts_ind].value === "x") {
            return alert('ğŸ¤¯ ìì‹ ì—ê²Œ ë§ëŠ” ì´ìˆ˜êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        }
        
        // 0. ìš°ì„  ê²€ìƒ‰ê²°ê³¼ í…Œì´ë¸”ì—ì„œ ê°’ì„ ë‹¤ ê¸ì–´ì˜¨ë‹¤.
        var year = document.getElementById('year').value;
        var semester = document.getElementById('semester').value;
        var subject_num = document.getElementById('subject_num').value;
        var subject_name = document.getElementById('subject_name').value;
        var classification = document.getElementById('classification').value;
        var selection = document.getElementById('selection').value;
        var grade = document.getElementById('grade').value;
        //  ë§Œì•½ ê¸°ì´ìˆ˜ê³¼ëª©í‘œì— ìˆëŠ” í•™ìˆ˜ë²ˆí˜¸ë¥¼ ì¶”ê°€í•˜ë ¤ í•œë‹¤ë©´?
        var now_s_num_list = []
        $('#mytable tr').each(
            function(){
                var inner_s_num = $(this).find('td').eq(2).text();
                if(inner_s_num === ""){
                    inner_s_num = $(this).find('td').eq(2).find('*').val();
                }
                now_s_num_list.push(inner_s_num)
            }
        );
        if(now_s_num_list.includes(subject_num)){
            // ì „ì²´ ë¦¬ìŠ¤íŠ¸ì— ë“¤ì–´ìˆìœ¼ë©´
            return alert('ğŸ¥µ ì´ë¯¸ ê¸°ì´ìˆ˜ê³¼ëª©í‘œì— í•´ë‹¹ í•™ìˆ˜ë²ˆí˜¸ê°€ ì¡´ì¬í•©ë‹ˆë‹¤!');
        }
        // 1. í–‰ìƒì„±
        var table = document.getElementById('mytable');
        var newRow = table.insertRow(1);
        // 2. í–‰ì— ê°ê° ì…€ ìƒì„±
        var newCell0 = newRow.insertCell(0);  // ë…„ë„
        var newCell1 = newRow.insertCell(1);  // í•™ê¸°
        var newCell2 = newRow.insertCell(2);  // í•™ìˆ˜ë²ˆí˜¸
        var newCell3 = newRow.insertCell(3);  // ê³¼ëª©ëª…
        var newCell4 = newRow.insertCell(4);  // ì´ìˆ˜êµ¬ë¶„
        var newCell5 = newRow.insertCell(5);  // ì„ íƒì˜ì—­
        var newCell6 = newRow.insertCell(6);  // í•™ì 
        var newCell7 = newRow.insertCell(7);  // ì‚­ì œë²„íŠ¼
        // 3. ê°ê°ì˜ ì…€ì— í´ë˜ìŠ¤ì§€ì •
        newCell0.className = 'new_td';
        newCell1.className = 'new_td';
        newCell2.className = 'new_td';
        newCell3.className = 'new_td';
        newCell4.className = 'new_td';
        newCell5.className = 'new_td';
        newCell6.className = 'new_td';
        newCell7.className = 'new_td';
        // 4. ì…€ì— ê°’ ì¶”ê°€
        newCell0.innerHTML = "<input class='new_td_input' type='text' name='year' value='" + year + "' readonly>";
        newCell1.innerHTML = "<input class='new_td_input' type='text' name='semester' value='" + semester + "' readonly>";
        newCell2.innerHTML = "<input class='new_td_input' type='text' name='subject_num' value='" + subject_num + "' readonly>";
        newCell3.innerHTML = "<input class='new_td_input' type='text' name='subject_name' value='" + subject_name + "' readonly>";
        newCell4.innerHTML = "<input class='new_td_input' type='text' name='classification' value='" + classification + "' readonly>";
        newCell5.innerHTML = "<input class='new_td_input' type='text' name='selection' value='" + selection + "' readonly>";
        newCell6.innerHTML = "<input class='new_td_input' type='text' name='grade' value='" + grade + "' readonly>";
        newCell7.innerHTML = "<button class='del_btn' onclick='del_row_new(this)'>ì‚­ì œ</button>";
        // ê²€ìƒ‰ ê²°ê³¼ì°½ì€ ì§€ì›Œì¤€ë‹¤. 
        var s_num = document.querySelector('#s_num');
        s_num.value = '';
        var result_div = document.querySelector('#result_div');
        result_div.innerHTML = "";
    }

    function del_row_new(obj) {
        // í…Œì´ë¸” ë¶ˆëŸ¬ì˜¤ê¸°
        var table = document.getElementById('mytable');
        // td -> tr -> í–‰ì¸ë±ìŠ¤ ì°¾ê¸°
        var index = $(obj).parent().parent().index();
        // í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì¸ë±ìŠ¤ ì‚­ì œ
        table.deleteRow(index);
    }

    function del_row_old(obj) {
        // del_s_num ì „ì—­ë°°ì—´ì— ì‚­ì œí•œ ê¸°ì¡´ ì»¤ìŠ¤í…€ì˜ í•™ìˆ˜ë²ˆí˜¸ë¥¼ ì¶”ê°€
        var tr = $(obj).parent().parent()
        var td = tr.children()
        var s_num = td.eq(2).text()
        list_delete.push(s_num);
        // í”„ë¡ íŠ¸ í…Œì´ë¸”ì—ì„œ ì‚­ì œ
        var table = document.getElementById('mytable');
        var index = $(obj).parent().parent().index();
        table.deleteRow(index);
    }

    function combine(){
        // ê°ê° ë¹ˆ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        var list_year = [];
        var list_semester = [];
        var list_subject_num = [];
        var list_subject_name = [];
        var list_classification = [];
        var list_selection = [];
        var list_grade = [];
        // ê°ê° ì¹¼ëŸ¼ë³„ nameìœ¼ë¡œ ëª¨ë‘ ë¶ˆëŸ¬ì™€ì„œ ë¦¬ìŠ¤íŠ¸ì—ë‹¤ê°€ ì €ì¥
        $('input[name=year]').each(function(index, item){
            list_year.push($(item).val());
        });
        $('input[name=semester]').each(function(index, item){
            list_semester.push($(item).val());
        });
        $('input[name=subject_num]').each(function(index, item){
            list_subject_num.push($(item).val());
        });
        $('input[name=subject_name]').each(function(index, item){
            list_subject_name.push($(item).val());
        });
        $('input[name=classification]').each(function(index, item){
            list_classification.push($(item).val());
        });
        $('input[name=selection]').each(function(index, item){
            list_selection.push($(item).val());
        });
        $('input[name=grade]').each(function(index, item){
            list_grade.push($(item).val());
        });
        // ë¦¬ìŠ¤íŠ¸ë¥¼ hidden inputìœ¼ë¡œ ë„£ì€ í›„ submit
        $('#id_year').val(list_year);
        $('#id_semester').val(list_semester);
        $('#id_subject_num').val(list_subject_num);
        $('#id_subject_name').val(list_subject_name);
        $('#id_classification').val(list_classification);
        $('#id_selection').val(list_selection);
        $('#id_grade').val(list_grade);
        // ì´ê±´ ê¸°ì¡´ ì»¤ìŠ¤í…€ì—ì„œ ì‚­ì œí•œ í•™ìˆ˜ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸
        $('#id_delete').val(list_delete);
    }


</script>

{% endblock %}